▎Руководство по работе с Docker в Java и IntelliJ IDEA на Windows

Содержание:

1. [Введение](#Введение)
2. [Скачивание и установка Docker на Windows](#Скачивание-и-установка-Docker-на-Windows)
3. [Интеграция Docker с IntelliJ IDEA](#Интеграция-Docker-с-IntelliJ-IDEA)
4. [Создание Java-приложения в IntelliJ IDEA](#Создание-Java-приложения-в-IntelliJ-IDEA)
5. [Создание Dockerfile с подробными пояснениями](#Создание-Dockerfile-с-подробными-пояснениями)
6. [Сборка Docker-образа](#Сборка-Docker-образа)
7. [Запуск Docker-контейнера](#Запуск-Docker-контейнера)
8. [Полезные команды Docker и шорткаты IntelliJ IDEA](#Полезные-команды-Docker-и-шорткаты-IntelliJ-IDEA)
9. [Заключение](#Заключение)

▎Введение

Docker является инструментом для контейнеризации приложений, позволяя вам создать изолированную среду для работы вашего приложения. Это особенно полезно для Java-разработчиков, так как обеспечивает единообразие окружения на всех этапах разработки, тестирования и продакшена.

В данном руководстве мы подробно рассмотрим, как установить Docker на Windows, интегрировать его с IntelliJ IDEA, создать простое Java-приложение, упаковать его в Docker-контейнер и запустить. Каждый шаг будет сопровождаться пояснениями и полезными шорткатами для повышения вашей эффективности.

▎Скачивание и установка Docker на Windows

▎1. Скачивание Docker Desktop

1. Откройте веб-браузер и перейдите на официальный сайт Docker:

   [https://www.docker.com/get-started](https://www.docker.com/get-started)

2. На странице нажмите кнопку "Get Docker Desktop".

3. Выберите версию для Windows:

    - Если у вас Windows 10 или Windows 11 с поддержкой WSL 2, выберите Docker Desktop for Windows (WSL 2).
    - Если у вас более старая версия Windows, проверьте системные требования или рассмотрите обновление ОС.

▎2. Установка Docker Desktop

1. После завершения скачивания запустите установочный файл Docker Desktop Installer.exe.

2. В окне установки отметьте галочки:
```
    - "Install required components for WSL 2" (если доступно).
    - "Add shortcut to desktop" (по желанию).
```
3. Нажмите "Ok" или "Install" для начала установки.

4. Дождитесь завершения установки. Это может занять несколько минут.

5. При появлении запроса на перезагрузку системы нажмите "Restart".

▎3. Первоначальная настройка Docker Desktop

1. После перезагрузки системы запустите Docker Desktop:

    - Дважды щелкните по значку Docker на рабочем столе.
    - Или нажмите Win и введите "Docker Desktop", затем нажмите Enter.

2. При первом запуске Docker Desktop может предложить вам войти в учетную запись Docker или создать новую.

    - Вы можете пропустить этот шаг, нажав "Skip for now".

3. Дождитесь, пока Docker запустится. Вы увидите сообщение "Docker Engine is starting", которое затем изменится на "Docker Engine is running".

▎4. Проверка установки Docker

1. Откройте Командную строку или PowerShell:
```
    - Нажмите Win + R, введите "cmd" или "powershell", нажмите Enter.
```
2. Введите команду:
```
   docker --version
```

3. Вы должны увидеть версию Docker, например:
```
3. Docker version 20.10.7, build f0df350
```
4. Для дополнительной проверки введите:

```
docker run hello-world
```


- Docker должен скачать образ hello-world и запустить контейнер, выводящий приветственное сообщение.

▎Интеграция Docker с IntelliJ IDEA

▎1. Установка плагина Docker в IntelliJ IDEA

1. Запустите IntelliJ IDEA.

2. Откройте настройки плагинов:
```
    - Перейдите в File → Settings.
    - Или используйте шорткат Ctrl + Alt + S.
```
3. В левой панели выберите Plugins.

4. В строке поиска введите "Docker".

5. Убедитесь, что плагин "Docker" от JetBrains установлен:
```
    - Если нет, нажмите кнопку "Install" рядом с плагином.
```
6. После установки плагина вам будет предложено перезапустить IntelliJ IDEA. Нажмите "Restart IDE".

▎2. Настройка подключения к Docker

1. После перезапуска откройте Docker Tool Window:
```
    - Перейдите в View → Tool Windows → Docker.
    - Или используйте шорткат Alt + 2.
```
2. В окне Services (в более новых версиях IDEA) должна отображаться секция Docker.

3. Если подключение не настроено:
```
    - В верхней части окна нажмите на значок "+" или шестеренки и выберите "Add Service...".

    - Выберите "Docker Connection".
```
4. В диалоговом окне убедитесь, что в поле "Engine API URL" указано tcp://localhost:2375 или просто Docker for Windows.

5. Нажмите "OK".
```
   Примечание: Если Docker не принимает подключения по TCP, вам может потребоваться включить эту опцию:

    - Откройте Docker Desktop.

    - Перейдите в Settings → General.

    - Отметьте галочку ```"Expose daemon on tcp://localhost:2375 without TLS".```

    - Нажмите ```"Apply & Restart".```
```
▎Создание Java-приложения в IntelliJ IDEA

▎1. Создание нового проекта

1. В IntelliJ IDEA закройте текущий проект или нажмите ```"File" → "New" → "Project...".```

2. В окне "New Project" выберите:
```
    - "Java" в разделе "Languages".

    - Убедитесь, что выбран установленный JDK (Java Development Kit). Если нет, нажмите "Download JDK" и установите последнюю версию.
```
3. Нажмите "Next".

4. Введите имя проекта, например, "DockerJavaApp", и выберите расположение.

5. Нажмите "Finish".

▎2. Написание простого Java-приложения

1. В окне проекта откройте папку "src".

2. Создайте новый пакет:
```
    - Щелкните правой кнопкой мыши по папке "src".

    - Выберите "New" → "Package".

    - Введите имя пакета, например, com.example.
```
3. Создайте новый класс:
```
    - Щелкните правой кнопкой мыши по пакету "com.example".

    - Выберите "New" → "Java Class".

    - Введите имя класса: Main.
```
4. Добавьте код в класс Main:

   ```
   package com.example;

   public class Main {
   public static void main(String[] args) {
   System.out.println("Привет из Docker!");
   }
   }
   ```
   


▎3. Сборка JAR-файла

▎Настройка артефакта для сборки JAR

1. Откройте настройки проекта:
```
    - Перейдите в File → Project Structure....

    - Или используйте шорткат Ctrl + Alt + Shift + S.
```
2. В левой панели выберите "Artifacts".

3. Нажмите кнопку "+" в верхней части окна и выберите "JAR" → "From modules with dependencies...".

4. В появившемся окне:
```
    - В поле "Module" выберите ваш модуль (должен быть выбран по умолчанию).

    - Отметьте галочкой "Include in project build" (если доступно).

    - В разделе "Main Class" нажмите кнопку "Browse...", найдите и выберите класс com.example.Main.
```
5. Нажмите "OK".

6. В окне "Project Structure" нажмите "Apply" и "OK".

▎Сборка артефакта

1. Постройте проект:
```
    - Перейдите в Build → Build Project.

    - Или используйте шорткат Ctrl + F9.
```
2. Соберите артефакт JAR:
```
    - Перейдите в Build → Build Artifacts....

    - В выпадающем списке выберите ваш артефакт, например, "DockerJavaApp:jar", и нажмите "Build".
```
3. Откройте окно "Build" в нижней части IDEA, чтобы убедиться в отсутствии ошибок.

4. Скомпилированный JAR-файл будет находиться в папке out/artifacts/.

▎Создание Dockerfile с подробными пояснениями

▎1. Создание файла Dockerfile

1. В корневой директории проекта (где находится папка src, out, .idea и файл pom.xml или build.gradle, если есть) создайте новый файл:
```
    - Щелкните правой кнопкой мыши по названию проекта в окне проекта.

    - Выберите "New" → "File".

    - Введите имя файла: "Dockerfile" и нажмите "Enter".
```
▎2. Написание содержимого Dockerfile

Введите следующий код в Dockerfile:

# Используем официальный образ OpenJDK как базовый
```
FROM openjdk:latest
```

# Устанавливаем рабочую директорию в контейнере
```
WORKDIR /app
```

# Копируем скомпилированный JAR-файл в контейнер
```
COPY out/artifacts/DockerJavaApp_jar/DockerJavaApp.jar app.jar
```
