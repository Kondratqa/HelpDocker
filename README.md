▎Руководство по работе с Docker в Java и IntelliJ IDEA на Windows

Содержание:

1. [Введение](#Введение)
2. [Скачивание и установка Docker на Windows](#Скачивание-и-установка-Docker-на-Windows)
3. [Интеграция Docker с IntelliJ IDEA](#Интеграция-Docker-с-IntelliJ-IDEA)
4. [Создание Java-приложения в IntelliJ IDEA](#Создание-Java-приложения-в-IntelliJ-IDEA)
5. [Создание Dockerfile с подробными пояснениями](#Создание-Dockerfile-с-подробными-пояснениями)
6. [Сборка Docker-образа](#Сборка-Docker-образа)
7. [Запуск Docker-контейнера](#Запуск-Docker-контейнера)
8. [Полезные команды Docker и шорткаты IntelliJ IDEA](#Полезные-команды-Docker-и-шорткаты-IntelliJ-IDEA)
9. [Заключение](#Заключение)

▎Введение

Docker является инструментом для контейнеризации приложений, позволяя вам создать изолированную среду для работы вашего приложения. Это особенно полезно для Java-разработчиков, так как обеспечивает единообразие окружения на всех этапах разработки, тестирования и продакшена.

В данном руководстве мы подробно рассмотрим, как установить Docker на Windows, интегрировать его с IntelliJ IDEA, создать простое Java-приложение, упаковать его в Docker-контейнер и запустить. Каждый шаг будет сопровождаться пояснениями и полезными шорткатами для повышения вашей эффективности.

▎Скачивание и установка Docker на Windows

▎1. Скачивание Docker Desktop

1. Откройте веб-браузер и перейдите на официальный сайт Docker:

   [https://www.docker.com/get-started](https://www.docker.com/get-started)

2. На странице нажмите кнопку "Get Docker Desktop".

3. Выберите версию для Windows:

    - Если у вас Windows 10 или Windows 11 с поддержкой WSL 2, выберите Docker Desktop for Windows (WSL 2).
    - Если у вас более старая версия Windows, проверьте системные требования или рассмотрите обновление ОС.

▎2. Установка Docker Desktop

1. После завершения скачивания запустите установочный файл Docker Desktop Installer.exe.

2. В окне установки отметьте галочки:
```
    - "Install required components for WSL 2" (если доступно).
    - "Add shortcut to desktop" (по желанию).
```
3. Нажмите "Ok" или "Install" для начала установки.

4. Дождитесь завершения установки. Это может занять несколько минут.

5. При появлении запроса на перезагрузку системы нажмите "Restart".

▎3. Первоначальная настройка Docker Desktop

1. После перезагрузки системы запустите Docker Desktop:

    - Дважды щелкните по значку Docker на рабочем столе.
    - Или нажмите Win и введите "Docker Desktop", затем нажмите Enter.

2. При первом запуске Docker Desktop может предложить вам войти в учетную запись Docker или создать новую.

    - Вы можете пропустить этот шаг, нажав "Skip for now".

3. Дождитесь, пока Docker запустится. Вы увидите сообщение "Docker Engine is starting", которое затем изменится на "Docker Engine is running".

▎4. Проверка установки Docker

1. Откройте Командную строку или PowerShell:
```
    - Нажмите Win + R, введите "cmd" или "powershell", нажмите Enter.
```
2. Введите команду:
```
   docker --version
```

3. Вы должны увидеть версию Docker, например:
```
3. Docker version 20.10.7, build f0df350
```
4. Для дополнительной проверки введите:

```
docker run hello-world
```


- Docker должен скачать образ hello-world и запустить контейнер, выводящий приветственное сообщение.

▎Интеграция Docker с IntelliJ IDEA

▎1. Установка плагина Docker в IntelliJ IDEA

1. Запустите IntelliJ IDEA.

2. Откройте настройки плагинов:
```
    - Перейдите в File → Settings.
    - Или используйте шорткат Ctrl + Alt + S.
```
3. В левой панели выберите Plugins.

4. В строке поиска введите "Docker".

5. Убедитесь, что плагин "Docker" от JetBrains установлен:
```
    - Если нет, нажмите кнопку "Install" рядом с плагином.
```
6. После установки плагина вам будет предложено перезапустить IntelliJ IDEA. Нажмите "Restart IDE".

▎2. Настройка подключения к Docker

1. После перезапуска откройте Docker Tool Window:
```
    - Перейдите в View → Tool Windows → Docker.
    - Или используйте шорткат Alt + 2.
```
2. В окне Services (в более новых версиях IDEA) должна отображаться секция Docker.

3. Если подключение не настроено:
```
    - В верхней части окна нажмите на значок "+" или шестеренки и выберите "Add Service...".

    - Выберите "Docker Connection".
```
4. В диалоговом окне убедитесь, что в поле "Engine API URL" указано tcp://localhost:2375 или просто Docker for Windows.

5. Нажмите "OK".
```
   Примечание: Если Docker не принимает подключения по TCP, вам может потребоваться включить эту опцию:

    - Откройте Docker Desktop.

    - Перейдите в Settings → General.

    - Отметьте галочку ```"Expose daemon on tcp://localhost:2375 without TLS".```

    - Нажмите ```"Apply & Restart".```
```
▎Создание Java-приложения в IntelliJ IDEA

▎1. Создание нового проекта

1. В IntelliJ IDEA закройте текущий проект или нажмите ```"File" → "New" → "Project...".```

2. В окне "New Project" выберите:
```
    - "Java" в разделе "Languages".

    - Убедитесь, что выбран установленный JDK (Java Development Kit). Если нет, нажмите "Download JDK" и установите последнюю версию.
```
3. Нажмите "Next".

4. Введите имя проекта, например, "DockerJavaApp", и выберите расположение.

5. Нажмите "Finish".

▎2. Написание простого Java-приложения

1. В окне проекта откройте папку "src".

2. Создайте новый пакет:
```
    - Щелкните правой кнопкой мыши по папке "src".

    - Выберите "New" → "Package".

    - Введите имя пакета, например, com.example.
```
3. Создайте новый класс:
```
    - Щелкните правой кнопкой мыши по пакету "com.example".

    - Выберите "New" → "Java Class".

    - Введите имя класса: Main.
```
4. Добавьте код в класс Main:

   ```
   package com.example;

   public class Main {
   public static void main(String[] args) {
   System.out.println("Привет из Docker!");
   }
   }
   ```
   


▎3. Сборка JAR-файла

▎Настройка артефакта для сборки JAR

1. Откройте настройки проекта:
```
    - Перейдите в File → Project Structure....

    - Или используйте шорткат Ctrl + Alt + Shift + S.
```
2. В левой панели выберите "Artifacts".

3. Нажмите кнопку "+" в верхней части окна и выберите "JAR" → "From modules with dependencies...".

4. В появившемся окне:
```
    - В поле "Module" выберите ваш модуль (должен быть выбран по умолчанию).

    - Отметьте галочкой "Include in project build" (если доступно).

    - В разделе "Main Class" нажмите кнопку "Browse...", найдите и выберите класс com.example.Main.
```
5. Нажмите "OK".

6. В окне "Project Structure" нажмите "Apply" и "OK".

▎Сборка артефакта

1. Постройте проект:
```
    - Перейдите в Build → Build Project.

    - Или используйте шорткат Ctrl + F9.
```
2. Соберите артефакт JAR:
```
    - Перейдите в Build → Build Artifacts....

    - В выпадающем списке выберите ваш артефакт, например, "DockerJavaApp:jar", и нажмите "Build".
```
3. Откройте окно "Build" в нижней части IDEA, чтобы убедиться в отсутствии ошибок.

4. Скомпилированный JAR-файл будет находиться в папке out/artifacts/.

▎Создание Dockerfile с подробными пояснениями

▎1. Создание файла Dockerfile

1. В корневой директории проекта (где находится папка src, out, .idea и файл pom.xml или build.gradle, если есть) создайте новый файл:
```
    - Щелкните правой кнопкой мыши по названию проекта в окне проекта.

    - Выберите "New" → "File".

    - Введите имя файла: "Dockerfile" и нажмите "Enter".
```
▎2. Написание содержимого Dockerfile

Введите следующий код в Dockerfile:

# Используем официальный образ OpenJDK как базовый
```
FROM openjdk:latest
```

# Устанавливаем рабочую директорию в контейнере
```
WORKDIR /app
```

# Копируем скомпилированный JAR-файл в контейнер
```
COPY out/artifacts/DockerJavaApp_jar/DockerJavaApp.jar app.jar
```

# Указываем команду для запуска приложения
ENTRYPOINT ["java", "-jar", "app.jar"]



▎Пояснения к каждому шагу:

- FROM openjdk:latest:
```
   - Указывает базовый образ, на основе которого будет строиться наш новый образ.
   - openjdk:latest означает, что будет использоваться последняя версия OpenJDK. Вы можете указать конкретную версию, например, openjdk:17-jdk-slim.
```
- WORKDIR /app:
```
   - Устанавливает рабочую директорию внутри контейнера на /app.
   - Все последующие команды будут относиться к этой директории.
```
- COPY out/artifacts/DockerJavaApp_jar/DockerJavaApp.jar app.jar:
```
   - Копирует файл нашего скомпилированного JAR из локальной файловой системы в контейнер.
   - Слева указан путь к файлу на вашей машине, справа — имя, под которым он будет сохранен в контейнере.
```
- ENTRYPOINT ["java", "-jar", "app.jar"]:
```
   - Определяет команду, которая будет выполнена при запуске контейнера.
   - Запускает наше Java-приложение.
```
Важно:
```
- Убедитесь, что путь к вашему JAR-файлу в команде COPY соответствует фактическому расположению файла.

- В нашем случае, если артефакт называется DockerJavaApp.jar и находится в папке out/artifacts/DockerJavaApp_jar/, то команда верна.
```
▎Сборка Docker-образа

▎1. Открытие терминала в IntelliJ IDEA

1. Откройте встроенный терминал:
```
   - Перейдите в View → Tool Windows → Terminal.

   - Или используйте шорткат Alt + F12.
```
2. В терминале вы должны оказаться в корневой директории вашего проекта.

▎2. Сборка образа с помощью Docker

Введите команду для сборки Docker-образа:
```
docker build -t yourusername/docker-java-app:1.0 .
```

Пояснения:
```
- docker build — команда для сборки образа.

- -t yourusername/docker-java-app:1.0 — устанавливает тег образа в формате репозиторий/имя:версия.

   - Замените yourusername на ваше имя пользователя или любое название репозитория.

   - docker-java-app — имя вашего приложения.

   - 1.0 — версия образа.
```

- . в конце команды указывает, что Dockerfile находится в текущей директории.

Пример:
```
docker build -t myuser/docker-java-app:1.0 .
```

▎3. Проверка созданного образа

После успешной сборки введите команду:
```
docker images
```

Вы должны увидеть список доступных образов, среди которых будет ваш:
```
REPOSITORY                TAG       IMAGE ID       CREATED          SIZE
myuser/docker-java-app    1.0       d1f5f2a5e3b4   10 seconds ago   690MB
```

▎Запуск Docker-контейнера

▎1. Запуск контейнера из образа

Выполните команду:
```
docker run --rm myuser/docker-java-app:1.0
```

Пояснения:
```
- docker run — запускает контейнер.

- --rm — автоматически удаляет контейнер после завершения работы.

- myuser/docker-java-app:1.0 — имя и тег вашего образа.
```
▎2. Результат выполнения

Если все настроено правильно, вы должны увидеть в терминале вывод:
```
Привет из Docker!
```

▎3. Дополнительные опции запуска

▎Проброс портов

Если ваше приложение слушает определенный порт (например, веб-сервер на порту 8080), используйте опцию -p:
```
docker run --rm -p 8080:8080 myuser/docker-java-app:1.0
```
```
- Первый 8080 — порт на вашей машине.

- Второй 8080 — порт внутри контейнера.
```
▎Передача переменных окружения

Если вашему приложению нужны переменные окружения:
```
docker run --rm -e "ENV_VAR_NAME=value" myuser/docker-java-app:1.0
```

- -e — обозначает переменную окружения.

▎Полезные команды Docker и шорткаты IntelliJ IDEA

▎Шорткаты IntelliJ IDEA
```
- Открыть настройки проекта: Ctrl + Alt + Shift + S

- Построить проект: Ctrl + F9

- Собрать артефакт: нажмите Ctrl + Shift + A, введите "Build Artifacts", выберите нужный артефакт и действие.

- Открыть терминал: Alt + F12

- Поиск по всем действиям: Ctrl + Shift + A

- Перейти к файлу: Ctrl + Shift + N

- Перейти к классу: Ctrl + N

- Авто-подстановка кода: Ctrl + Space
```
▎Полезные команды Docker
```
- Список доступных образов:
```
  ```docker images```

- Список запущенных контейнеров:
```
  docker ps
```

- Список всех контейнеров (включая остановленные):
```
  docker ps -a
```

- Удаление образа:
```
  docker rmi image_name
```

- Удаление контейнера:
```
  docker rm container_id
```

- Просмотр логов контейнера:
```
  docker logs container_id
```

- Запуск команды внутри запущенного контейнера:
```
  docker exec -it container_id /bin/bash
```

- Позволяет получить доступ к консоли внутри контейнера.

- Остановка запущенного контейнера:
```
  docker stop container_id
```

▎Заключение

Поздравляем! Вы успешно настроили окружение для работы с Docker в Java и IntelliJ IDEA на Windows. Вы научились создавать Java-приложение, упаковывать его в Docker-образ и запускать в контейнере.

Советы и лучшие практики:
```
- Используйте .dockerignore файл:

   - Создайте файл .dockerignore в корне проекта.

   - Укажите файлы и папки, которые не должны попадать в контекст сборки (например, .git, *.iml, out/).
```
- Оптимизируйте Dockerfile:
```
   - Используйте более легкие базовые образы, например, openjdk:17-jdk-slim.

   - Минимизируйте количество слоев, объединяя команды с помощью &&.
```
- Автоматизируйте сборку и развертывание:
```
   - Используйте скрипты или инструменты CI/CD для автоматической сборки образов.
```
- Следите за версиями:
```
   - Указывайте конкретные версии базовых образов для предсказуемости.
```
- Обновляйте Docker и IntelliJ IDEA:
```
   - Регулярно проверяйте обновления для получения новых возможностей и улучшений.
```
Теперь вы готовы применять эти знания в реальных задачах и проектах. Успехов в разработке!
```
  docker ps
```

- Список всех контейнеров (включая остановленные):
```
  docker ps -a
```

- Удаление образа:
```
  docker rmi image_name
```

- Удаление контейнера:
```
  docker rm container_id
```

- Просмотр логов контейнера:
```
  docker logs container_id
```

- Запуск команды внутри запущенного контейнера:
```
  docker exec -it container_id /bin/bash
```

- Позволяет получить доступ к консоли внутри контейнера.

- Остановка запущенного контейнера:
```
  docker stop container_id
```

▎Заключение

Поздравляем! Вы успешно настроили окружение для работы с Docker в Java и IntelliJ IDEA на Windows. Вы научились создавать Java-приложение, упаковывать его в Docker-образ и запускать в контейнере.

Советы и лучшие практики:
```
- Используйте .dockerignore файл:

   - Создайте файл .dockerignore в корне проекта.

   - Укажите файлы и папки, которые не должны попадать в контекст сборки (например, .git, *.iml, out/).

- Оптимизируйте Dockerfile:

   - Используйте более легкие базовые образы, например, openjdk:17-jdk-slim.

   - Минимизируйте количество слоев, объединяя команды с помощью &&.

- Автоматизируйте сборку и развертывание:

   - Используйте скрипты или инструменты CI/CD для автоматической сборки образов.

- Следите за версиями:

   - Указывайте конкретные версии базовых образов для предсказуемости.

- Обновляйте Docker и IntelliJ IDEA:

   - Регулярно проверяйте обновления для получения новых возможностей и улучшений.
```
Теперь вы готовы применять эти знания в реальных задачах и проектах. Успехов в разработке!
